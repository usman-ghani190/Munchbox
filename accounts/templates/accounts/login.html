{% load static %}
<!DOCTYPE html>
<html lang="en">
  <!-- munchbox/login.html  05 Dec 2019 10:25:12 GMT -->
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="keywords" content="#" />
    <meta name="description" content="#" />
    <title>Munchbox | Login</title>
    <!-- Fav and touch icons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="#" />
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="#" />
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="#" />
    <link rel="apple-touch-icon-precomposed" href="#" />
    <link rel="shortcut icon" href="#" />
    <!-- Bootstrap -->
    <link
      href="{% static 'app/assets/css/bootstrap.min.css' %}"
      rel="stylesheet"
    />
    <!-- Fontawesome -->
    <link
      href="{% static 'app/assets/css/font-awesome.css' %}"
      rel="stylesheet"
    />
    <!-- Flaticons -->
    <link
      href="{% static 'app/assets/css/font/flaticon.css' %}"
      rel="stylesheet"
    />
    <!-- Swiper Slider -->
    <link
      href="{% static 'app/assets/css/swiper.min.css' %}"
      rel="stylesheet"
    />
    <!-- Range Slider -->
    <link
      href="{% static 'app/assets/css/ion.rangeSlider.min.css' %}"
      rel="stylesheet"
    />
    <!-- magnific popup -->
    <link
      href="{% static 'app/assets/css/magnific-popup.css' %}"
      rel="stylesheet"
    />
    <!-- Nice Select -->
    <link
      href="{% static 'app/assets/css/nice-select.css' %}"
      rel="stylesheet"
    />
    <!-- Custom Stylesheet -->
    <link href="{% static 'app/assets/css/style.css' %}" rel="stylesheet" />
    <!-- Custom Responsive -->
    <link
      href="{% static 'app/assets/css/responsive.css' %}"
      rel="stylesheet"
    />
    <!-- Google Fonts -->
    <link
      href="https://fonts.googleapis.com/css?family=Poppins:300,400,500,600,700&amp;display=swap"
      rel="stylesheet"
    />
    <!-- place -->
  </head>

  <body>
    <div class="inner-wrapper">
      <div class="container-fluid no-padding">
        <div class="row no-gutters overflow-auto">
          <div class="col-md-6">
            <div class="main-banner">
              <img
                src="{% static 'app/assets/img/banner/banner-1.jpg' %}"
                class="img-fluid full-width main-img"
                alt="banner"
              />
              <div class="overlay-2 main-padding">
                <img
                  src="{% static 'app/assets/img/logo-2.jpg' %}"
                  class="img-fluid"
                  alt="logo"
                />
              </div>
              <img
                src="{% static 'app/assets/img/banner/burger.png' %}"
                class="footer-img"
                alt="footer-img"
              />
            </div>
          </div>
          <div class="col-md-6">
            <div class="section-2 user-page main-padding">
              <div class="login-sec">
                <div class="login-box">
                  <form id="login-form">
                    <h4 class="text-light-black fw-600">
                      Sign in with your Munchbox account
                    </h4>
                    <div
                      id="form-errors"
                      class="alert alert-danger"
                      style="display: none"
                    ></div>
                    <div class="row">
                      <div class="col-12">
                        <p class="text-light-black">
                          Have a corporate username?
                          <a href="{% url 'add_restaurant' %}">Click here</a>
                        </p>
                        <div class="form-group">
                          <label class="text-light-white fs-14">Email</label>
                          <input
                            type="email"
                            name="email"
                            class="form-control form-control-submit"
                            placeholder="Email I'd"
                            required
                          />
                        </div>
                        <div class="form-group">
                          <label class="text-light-white fs-14">Password</label>
                          <input
                            type="password"
                            id="password-field"
                            name="password"
                            class="form-control form-control-submit"
                            placeholder="Password"
                            required
                          />
                          <div
                            data-name="#password-field"
                            class="fa fa-fw fa-eye field-icon toggle-password"
                          ></div>
                        </div>
                        <div class="form-group checkbox-reset">
                          <label class="custom-checkbox mb-0">
                            <input type="checkbox" name="keep_signed_in" />
                            <span class="checkmark"></span> Keep me signed in
                          </label>
                          <a href="{% url 'password_reset' %}"
                            >Reset password</a
                          >
                        </div>
                        <div class="form-group">
                          <button
                            type="submit"
                            class="btn-second btn-submit full-width"
                          >
                            <img
                              src="{% static 'app/assets/img/M.png' %}"
                              alt="btn logo"
                            />Sign in
                          </button>
                        </div>
                        <div class="form-group text-center">
                          <span>or</span>
                        </div>
                        <div class="form-group">
                          <button
                            type="submit"
                            class="btn-second btn-facebook full-width"
                          >
                            <img
                              src="{% static 'app/assets/img/facebook-logo.svg' %}"
                              alt="btn logo"
                            />Continue with Facebook
                          </button>
                        </div>
                        <div class="form-group">
                          <button
                            type="submit"
                            class="btn-second btn-google full-width"
                          >
                            <img
                              src="{% static 'app/assets/img/google-logo.png' %}"
                              alt="btn logo"
                            />Continue with Google
                          </button>
                        </div>
                        <div class="form-group text-center mb-0">
                          <a href="{% url 'register' %}">Create your account</a>
                        </div>
                      </div>
                    </div>
                  </form>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Place all Scripts Here -->
    <!-- jQuery -->
    <script src="{% static 'app/assets/js/jquery.min.js' %}"></script>
    <!-- Popper -->
    <script src="{% static 'app/assets/js/popper.min.js' %}"></script>
    <!-- Bootstrap -->
    <script src="{% static 'app/assets/js/bootstrap.min.js' %}"></script>
    <!-- Range Slider -->
    <script src="{% static 'app/assets/js/ion.rangeSlider.min.js' %}"></script>
    <!-- Swiper Slider -->
    <script src="{% static 'app/assets/js/swiper.min.js' %}"></script>
    <!-- Nice Select -->
    <script src="{% static 'app/assets/js/jquery.nice-select.min.js' %}"></script>
    <!-- magnific popup -->
    <script src="{% static 'app/assets/js/jquery.magnific-popup.min.js' %}"></script>
    <!-- Maps -->
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDnd9JwZvXty-1gHZihMoFhJtCXmHfeRQg"></script>
    <!-- sticky sidebar -->
    <script src="{% static 'app/assets/js/sticksy.js' %}"></script>
    <!-- Munch Box Js -->
    <script src="{% static 'app/assets/js/munchbox.js' %}"></script>
    <!-- /Place all Scripts Here -->
    <script>
            $(document).ready(function() {
                $('#login-form').on('submit', function(e) {
                    e.preventDefault();
                    var formData = $(this).serializeArray();
                    var data = {};
                    $.each(formData, function(i, field) {
                        data[field.name] = field.value;
                    });
                    function getCookie(name) {
                      let cookieValue = null;
                      if (document.cookie && document.cookie !== '') {
                          const cookies = document.cookie.split(';');
                          for (let i = 0; i < cookies.length; i++) {
                              const cookie = cookies[i].trim();
                              if (cookie.substring(0, name.length + 1) === (name + '=')) {
                                  cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                                  break;
                              }
                          }
                      }
                      return cookieValue;
                  }

                  const csrftoken = getCookie('csrftoken');
                    $.ajax({
                        url: '{% url 'api_login' %}',
                        type: 'POST',
                        data: JSON.stringify(data),
                        contentType: 'application/json',
                        headers: {'X-CSRFToken': csrftoken},
                        success: function(response) {
                            localStorage.setItem('token', response.token);
                            window.location.href = '/'; // Redirect to homepage
                        },
                        error: function(xhr) {
                            var errors = xhr.responseJSON;
                            var errorHtml = '';
                            $.each(errors, function(key, value) {
                                errorHtml += '<p>' + (Array.isArray(value) ? value.join('<br>') : value) + '</p>';
                            });
                            $('#form-errors').html(errorHtml).show();
                        }
                    });
                });

                $('.toggle-password').click(function() {
                    var field = $($(this).data('name'));
                    var type = field.attr('type') === 'password' ? 'text' : 'password';
                    field.attr('type', type);
                    $(this).toggleClass('fa-eye fa-eye-slash');
                });
            });
    </script>
  </body>

  <!-- munchbox/login.html  05 Dec 2019 10:25:15 GMT -->
</html>
